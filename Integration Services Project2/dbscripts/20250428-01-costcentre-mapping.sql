CALL MIGRATION.STE_START_PATCH('20250428-01-COSTCENTRE-MAPPING');

--CREATE TABLE "MIGRATION"."SBST_COSTCENTRE_MAPPING"  (
--		  "ID" BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY (  
--		    START WITH +1  
--		    INCREMENT BY +1  
--		    MINVALUE +1  
--		    MAXVALUE +9223372036854775807  
--		    NO CYCLE  
--		    CACHE 20  
--		    NO ORDER ) , 
--		  "COSWIN_CC" VARCHAR(50 OCTETS),	
--		  "COSWIN_DESC" VARCHAR(150 OCTETS),
--		  "MAXIMO_CC" VARCHAR(10 OCTETS),	
--		  "MAXIMO_DESC" VARCHAR(150 OCTETS)
--	)   
--;

-- BRING "MIGRATION"."SBST_COSTCENTRE_MAPPING" MANUALLY FROM ON-PREM

-- UPDATE COSTCENTER INVALID MAPPING
INSERT INTO MIGRATION.SBST_COSTCENTER_INVALID_MAPPING(
	COSWIN_CC, MAXIMO_CC
)
SELECT TRIM(A.COSWIN_CC) AS COSWIN_CC, TRIM(A.MAXIMO_CC) AS MAXIMO_CC
FROM MIGRATION.SBST_COSTCENTRE_MAPPING A
LEFT JOIN MIGRATION.SBST_COSTCENTER_INVALID_MAPPING B ON B.COSWIN_CC=A.COSWIN_CC
WHERE TRIM(A.COSWIN_CC)!=TRIM(A.MAXIMO_CC) AND B.ID IS NULL;

-- UPDATE GLCOMPONENTS: NO NEED! ALL ARE ALREADY CREATED!
--SELECT TRIM(A.MAXIMO_CC) AS MAXIMO_CC, A.MAXIMO_DESC
--FROM MIGRATION.SBST_COSTCENTRE_MAPPING A
--LEFT JOIN MAXIMO.GLCOMPONENTS B ON B.GLORDER=1 AND B.COMPVALUE=TRIM(A.MAXIMO_CC)
--WHERE B.GLCOMPONENTSID IS NULL;

CALL MIGRATION.STE_FINISH_PATCH('20250428-01-COSTCENTRE-MAPPING');
